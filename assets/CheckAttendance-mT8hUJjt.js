import{r as l,j as s,I as G,B as P,F as m,e as O,g as J,h as K}from"./index-BH5pS4hG.js";import{A as V,a as W,b as X}from"./avatar-zQEKFf8y.js";import{C as Y,a as Z,T as ee,b as se,c as N,d as g,e as te,f as u}from"./card-Ca26zv7l.js";import{a as j}from"./axios-1xl_CE3x.js";import{L as ae,y as f}from"./index-KGe23Xc9.js";import{S as B}from"./sweetalert2.esm.all-B0Dix5B2.js";import{D as re}from"./DialogAddMember-DOjIrJYt.js";import"./index-DDJYQFiM.js";import"./dialog-fLalf1NI.js";import"./index-x2yT96P-.js";import"./select-BJDUn7MR.js";function me(){const C={fullname:"",role:"",photo:null},[q,A]=l.useState(!1),[b,F]=l.useState([]),[p,H]=l.useState(""),[w,y]=l.useState([]),[d,T]=l.useState(new Set),[c,M]=l.useState(new Set),[E,x]=l.useState({}),[o,h]=l.useState(C),[L,$]=l.useState(!1),[I,S]=l.useState(null);l.useEffect(()=>{y(b.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())||e.role.toLowerCase().includes(p.toLowerCase())))},[p,b]),l.useEffect(()=>{k()},[]);const k=async()=>{try{const e=await j.get("list-of-member",{headers:{"Content-Type":"application/json"}});console.log("API Response:",e),console.log("List of Members:",e.data.listOfMembersAlreadyAtt),F(e.data.listOfMembersAlreadyAtt),y(e.data.listOfMembersAlreadyAtt)}catch(e){console.error("Error fetching members:",e)}},Q=e=>{const{name:t,value:a}=e.target;h({...o,[t]:a}),x({...E,[t]:""})},_=()=>{const e={};return o.fullname||(e.fullname="Full name is required"),o.role||(e.role="Role is required"),e},z=async e=>{e.preventDefault();const t=_();if(Object.keys(t).length>0){x(t);return}const a=new FormData;if(a.append("name",o.fullname),a.append("role",o.role),o.photo&&a.append("photo",o.photo),!L){$(!0);try{await j.post("list-of-member",a,{headers:{"Content-Type":"multipart/form-data"}}),A(!1),B.fire({icon:"success",title:"Success",text:"Member added successfully!",timer:2e3,showConfirmButton:!1}).then(()=>{k()}),h(C),S(null),x({});const r=document.getElementById("picture");r&&(r.value="")}catch(r){console.error("Error adding member:",r),B.fire({icon:"error",title:"Error",text:"There was an error adding the member. Please try again."})}finally{$(!1)}}},R=async(e,t,a)=>{try{const n=(await j.get(`list-of-member/${e}`)).data.attendance_status,D=a==="present"?0:1;if(n===D){f.info(`${t} is already marked as ${a}.`);return}a==="present"?T(i=>new Set(i).add(e)):M(i=>new Set(i).add(e)),await j.put(`list-of-member/${e}`,{attendance_status:1,status:D}),a==="present"?f.success(`${t} marked as present.`):f.error(`${t} marked as absent.`),F(i=>i.filter(v=>v.id!==e)),y(i=>i.filter(v=>v.id!==e))}catch(r){if(r.response&&r.response.status===409){const n=r.response.data.message;f.error(n);return}else f.error(`Failed to update attendance for ${t}.`)}finally{a==="present"?T(r=>{const n=new Set(r);return n.delete(e),n}):M(r=>{const n=new Set(r);return n.delete(e),n})}},U=e=>{var a;const t=(a=e.target.files)==null?void 0:a[0];if(t)if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(t.type))h({...o,photo:null}),S(null);else{h({...o,photo:t});const n=new FileReader;n.onloadend=()=>{S(n.result)},n.readAsDataURL(t)}};return s.jsxs("div",{className:"ml-56 mx-auto md:ml-0 md:w-full",children:[s.jsx(ae,{}),s.jsx("div",{className:"grid grid-cols-3 gap-4",children:s.jsx("div",{className:"col-span-3",children:s.jsx("div",{className:"rounded-md min-h-80 pl-2 md:pl-0",children:s.jsxs(Y,{children:[s.jsxs("div",{className:"py-2 flex flex-row justify-between",children:[s.jsx(Z,{className:"text-lg md:text-base",children:"Check Attendance"}),s.jsx(G,{type:"text",placeholder:"Search",className:"w-52",value:p,onChange:e=>H(e.target.value)})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ee,{className:"w-full",children:[s.jsx(se,{children:s.jsxs(N,{children:[s.jsx(g,{className:"text-center md:text-xs",children:"Photo"}),s.jsx(g,{className:"md:text-xs",children:"Full Name"}),s.jsx(g,{className:"md:text-xs",children:"Role/Ministry"}),s.jsx(g,{className:"text-right md:text-xs",children:"Action"})]})}),s.jsx(te,{children:w.length>0?w.map(e=>s.jsxs(N,{children:[s.jsx(u,{className:"flex justify-center md:justify-center item-center md:h-24 ",children:e.photo?s.jsx("img",{src:`https://jamctagoloan.xyz/storage/${e.photo}`,alt:e.name,className:"rounded-full h-10 md:mt-5 w-10"}):s.jsxs(V,{className:"h-10 md:mt-5 w-10",children:[s.jsx(W,{src:"https://github.com/shadcn.png"}),s.jsx(X,{children:"CN"})]})}),s.jsx(u,{className:"md:text-xs",children:e.name}),s.jsx(u,{className:"md:text-xs",children:e.role}),s.jsx(u,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end md:flex-col md:gap-3 items-center gap-1",children:[s.jsx(P,{className:`text-white h-7 bg-green-500 hover:bg-green-400 rounded-md ${c.has(e.id)||d.has(e.id)?"cursor-not-allowed":""}`,onClick:()=>R(e.id,e.name,"present"),disabled:c.has(e.id)||d.has(e.id),children:d.has(e.id)?s.jsx(m,{icon:O,spin:!0}):s.jsxs(s.Fragment,{children:[s.jsx(m,{icon:J})," Present"]})}),s.jsx(P,{className:`text-white h-7 bg-red-500 hover:bg-red-400 rounded-md ${d.has(e.id)||c.has(e.id)?"cursor-not-allowed":""}`,onClick:()=>R(e.id,e.name,"absent"),disabled:d.has(e.id)||c.has(e.id),children:c.has(e.id)?s.jsx(m,{icon:O,spin:!0}):s.jsxs(s.Fragment,{children:[s.jsx(m,{icon:K})," Absent"]})})]})})]},e.id)):s.jsx(N,{children:s.jsx(u,{colSpan:4,className:"text-center py-4",children:"No record found"})})})]})}),s.jsx("div",{className:"flex flex-row justify-end mt-5",children:s.jsx("div",{children:s.jsxs("p",{className:"text-primary text-base w-full font-bold",children:["Showing 1 to ",w.length," entries"]})})})]})})})}),s.jsx(re,{isDialogOpen:q,setIsDialogOpen:A,formData:o,setFormData:h,errors:E,setErrors:x,handleInputChange:Q,handleAddFileChange:U,handleSubmit:z,photoPreview:I,loading:L})]})}export{me as default};
