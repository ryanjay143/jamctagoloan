import{r as o,j as e,B as L,F as O,s as q,t as T,I as A,v as z}from"./index-CmnVr4VI.js";import{a as I}from"./axios-1xl_CE3x.js";import{C as K,a as Q,T as W,b as G,c as E,d as N,e as J,f as j}from"./card--R3bHBL8.js";import{S as F}from"./sweetalert2.esm.all-B0Dix5B2.js";import{A as X,a as Y,b as Z}from"./avatar-DPlwHBsa.js";import{D as ee,a as se,b as ae,c as te,d as re,e as le}from"./dialog-BohNxKJo.js";import{S as _,a as k,b as B,c as U,d as l}from"./select-CtuPSdk4.js";import{D as ne}from"./DialogAddMember-DPcfjtpD.js";import"./index-CmtNVF9T.js";import"./index-Bm1TY_Ua.js";const ie=({member:u,onUpdate:c,fetchMembers:h})=>{const[a,d]=o.useState(u),[x,v]=o.useState(!1),[y,p]=o.useState(!1),[b,g]=o.useState(u.photo?`https://jamctagoloan.xyz/storage/${u.photo}`:null),D=t=>{const{name:n,value:m}=t.target;d({...a,[n]:m})},C=t=>{var m;const n=(m=t.target.files)==null?void 0:m[0];if(n)if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(n.type))g(null);else{const w=new FileReader;w.onloadend=()=>{g(w.result)},w.readAsDataURL(n),d({...a,photo:n})}},f=async()=>{if(x)return;v(!0);const t=new FormData;t.append("name",a.name),t.append("role",a.role),t.append("church_status",a.church_status),t.append("attendance_status",a.attendance_status),a.photo instanceof File&&t.append("photo",a.photo);try{const n=await I.post(`edit-member/${a.id}`,t,{headers:{"Content-Type":"multipart/form-data"}});c(n.data.listOfMember),p(!1),F.fire({icon:"success",title:"Success",text:n.data.message,timer:2e3,showConfirmButton:!1}).then(()=>{h()})}catch(n){console.error("Error updating member:",n),F.fire({icon:"error",title:"Error",text:"There was an error updating the member. Please try again."})}finally{v(!1)}};return e.jsx("div",{children:e.jsxs(ee,{open:y,onOpenChange:p,children:[e.jsx(se,{asChild:!0,children:e.jsx(L,{className:"text-white w-7 h-7 bg-green-500 hover:bg-green-400 rounded-md",children:e.jsx(O,{icon:q})})}),e.jsxs(ae,{className:"overflow-auto md:max-h-[90vh]  max-h-[100%] md:max-w-[400px]",children:[e.jsxs(te,{className:"text-start",children:[e.jsx(re,{children:"Edit Member Info"}),e.jsx(le,{children:"Edit member to the list."})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(T,{htmlFor:"fullname",children:"Full Name"}),e.jsx(A,{type:"text",name:"name",placeholder:"Enter fullname",value:a.name,onChange:D})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(T,{htmlFor:"role",children:"Role/Ministry"}),e.jsxs(_,{name:"role",value:a.role,onValueChange:t=>d({...a,role:t}),children:[e.jsx(k,{children:e.jsx(B,{placeholder:"Select role or ministry"})}),e.jsxs(U,{className:"max-h-60 overflow-auto",children:[e.jsx(l,{value:"First timer",children:"First timer"}),e.jsx(l,{value:"Regular",children:"Regular"}),e.jsx(l,{value:"Church Pastor",children:"Church Pastor"}),e.jsx(l,{value:"Multimedia Service Team",children:"Multimedia Service Team"}),e.jsx(l,{value:"Ushering Service Team",children:"Ushering Service Team"}),e.jsx(l,{value:"Prayer Service Team",children:"Prayer Service Team"}),e.jsx(l,{value:"Finance Team",children:"Finance Team"}),e.jsx(l,{value:"Praise & Worship Team",children:"Praise & Worship Team"}),e.jsx(l,{value:"Kids Ministry",children:"Kids Ministry"}),e.jsx(l,{value:"Cleaning Ministry",children:"Cleaning Ministry"}),e.jsx(l,{value:"Family life",children:"Family life"}),e.jsx(l,{value:"Arrow life",children:"Arrow life"}),e.jsx(l,{value:"Visitor",children:"Visitor"})]})]})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(T,{htmlFor:"churchStatus",children:"Church Status"}),e.jsxs(_,{name:"church_status",value:a.church_status,onValueChange:t=>d({...a,church_status:t}),children:[e.jsx(k,{children:e.jsx(B,{placeholder:"Select Status"})}),e.jsxs(U,{children:[e.jsx(l,{value:"0",children:"Active"}),e.jsx(l,{value:"1",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"grid items-center gap-1.5",children:[e.jsx(T,{htmlFor:"picture",children:"Photo"}),e.jsx(A,{id:"edit-picture",type:"file",onChange:C,accept:"image/*"}),b&&e.jsx("img",{src:b,alt:"Preview",className:"w-full rounded-md"})]}),e.jsx(L,{onClick:f,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Saving..."}),e.jsx("span",{className:"animate-spin border-2 border-white border-t-transparent rounded-full w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{icon:z}),"Save Changes"]})})]})]})})},je=()=>{const u={fullname:"",role:"",photo:null},[c,h]=o.useState(u),[a,d]=o.useState({}),[x,v]=o.useState([]),[y,p]=o.useState([]),[b,g]=o.useState(null),[D,C]=o.useState(!1),[f,t]=o.useState(""),[n,m]=o.useState(!1);o.useEffect(()=>{M()},[]),o.useEffect(()=>{p(x.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.role.toLowerCase().includes(f.toLowerCase())))},[f,x]);const R=s=>{const{name:i,value:r}=s.target;h({...c,[i]:r}),d({...a,[i]:""})},w=s=>{var r;const i=(r=s.target.files)==null?void 0:r[0];if(i)if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(i.type))h({...c,photo:null}),g(null);else{h({...c,photo:i});const P=new FileReader;P.onloadend=()=>{g(P.result)},P.readAsDataURL(i)}},V=()=>{const s={};return c.fullname||(s.fullname="Full name is required"),c.role||(s.role="Role is required"),s},$=async s=>{s.preventDefault();const i=V();if(Object.keys(i).length>0){d(i);return}const r=new FormData;if(r.append("name",c.fullname),r.append("role",c.role),c.photo&&r.append("photo",c.photo),!n){m(!0);try{await I.post("list-of-member",r,{headers:{"Content-Type":"multipart/form-data"}}),C(!1),F.fire({icon:"success",title:"Success",text:"Member added successfully!",timer:2e3,showConfirmButton:!1}).then(()=>{M()}),h(u),g(null),d({});const S=document.getElementById("picture");S&&(S.value="")}catch(S){console.error("Error adding member:",S),F.fire({icon:"error",title:"Error",text:"There was an error adding the member. Please try again."})}finally{m(!1)}}},M=async()=>{try{const s=await I.get("list-of-member",{headers:{"Content-Type":"application/json"}});console.log("API Response:",s),console.log("List of Members:",s.data.listOfMembers),v(s.data.listOfMembers),p(s.data.listOfMembers)}catch(s){console.error("Error fetching members:",s)}},H=s=>{v(i=>i.map(r=>r.id===s.id?s:r)),p(i=>i.map(r=>r.id===s.id?s:r))};return e.jsxs("div",{className:"ml-56 mx-auto md:ml-0 md:w-full mt-3",children:[e.jsx("div",{className:"grid grid-cols-3 gap-4",children:e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"rounded-md min-h-80 pl-2 md:pl-0",children:e.jsxs(K,{children:[e.jsxs("div",{className:"py-2 flex flex-row justify-between",children:[e.jsx(Q,{className:"text-lg md:text-base",children:"List of Member"}),e.jsx(A,{type:"text",placeholder:"Search",className:"w-52",value:f,onChange:s=>t(s.target.value)})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{className:"w-full",children:[e.jsx(G,{children:e.jsxs(E,{children:[e.jsx(N,{className:"text-center md:text-xs",children:"Photo"}),e.jsx(N,{className:"md:text-xs",children:"Full Name"}),e.jsx(N,{className:"md:text-xs",children:"Role/Ministry"}),e.jsx(N,{className:"md:text-xs",children:"Status"}),e.jsx(N,{className:"text-right md:text-xs",children:"Action"})]})}),e.jsx(J,{children:y.length>0?y.map(s=>e.jsxs(E,{children:[e.jsx(j,{className:"flex justify-center items-center",children:s.photo?e.jsx("img",{src:`https://jamctagoloan.xyz/storage/${s.photo}`,alt:s.name||"Member Photo",className:"rounded-full h-10 w-10"}):e.jsxs(X,{children:[e.jsx(Y,{src:"https://github.com/shadcn.png"}),e.jsx(Z,{children:"CN"})]})}),e.jsx(j,{className:"md:text-xs",children:s.name}),e.jsx(j,{className:"md:text-xs",children:s.role}),e.jsx(j,{children:s.church_status==="0"?e.jsx("span",{className:"inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20",children:"Active"}):s.church_status==="1"?e.jsx("span",{className:"inline-flex items-center rounded-md bg-pink-50 px-2 py-1 text-xs font-medium text-pink-700 ring-1 ring-inset ring-pink-700/10",children:"Inactive"}):null}),e.jsx(j,{className:"text-right",children:e.jsx("div",{className:"flex justify-end items-center gap-1",children:e.jsx(ie,{member:s,onUpdate:H,fetchMembers:M})})})]},s.id)):e.jsx(E,{children:e.jsx(j,{colSpan:5,className:"text-center py-4",children:"No record found"})})})]})}),e.jsx("div",{className:"flex flex-row justify-end mt-5",children:e.jsx("div",{children:e.jsxs("p",{className:"text-primary text-base w-full font-bold",children:["Showing 1 to ",y.length," entries"]})})})]})})})}),e.jsx(ne,{isDialogOpen:D,setIsDialogOpen:C,formData:c,setFormData:h,errors:a,setErrors:d,handleInputChange:R,handleAddFileChange:w,handleSubmit:$,photoPreview:b,loading:n})]})};export{je as default};
